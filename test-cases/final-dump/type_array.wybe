type raw_int_array is address {
    pub def raw_index(current: raw_int_array, index: int, size_in_bytes: int, ?ret_value: int) {
        foreign lpvm access(current, index * 8, size_in_bytes, 0, ?ret_value)
    }
}

def alloc_raw_int_array(size: int, ?buffer: raw_int_array) {
    ?buffer = foreign lpvm alloc(size * 8)
}

pub type int_array {
    pub int_array(buffer: raw_int_array, size: int)

    pub def index(current: int_array, index: int, ?value: int) {
        raw_index(buffer(current), index, size(current) * 8, ?value)
    }
}

pub def array(size: int, ?res_array: int_array) {
    ?raw_array = alloc_raw_int_array(size)
    ?res_array = int_array(raw_array, size)
}

?a = array(10)
